<Window x:Class="LSR.XmlHelper.Wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:infra="clr-namespace:LSR.XmlHelper.Wpf.Infrastructure"
        xmlns:avalonedit="http://icsharpcode.net/sharpdevelop/avalonedit"
        mc:Ignorable="d"
        Title="{Binding Title}"
        Height="450"
        Width="900">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
        <infra:InverseBooleanToVisibilityConverter x:Key="InverseBoolToVis" />
    </Window.Resources>

    <DockPanel LastChildFill="True">

        <StackPanel DockPanel.Dock="Top"
                    Orientation="Horizontal"
                    Margin="8">

            <Button Content="Open Folder"
                    MinWidth="100"
                    Margin="0,0,8,0"
                    Command="{Binding OpenCommand}" />

            <Button Content="Format"
                    MinWidth="70"
                    Margin="0,0,8,0"
                    Command="{Binding FormatCommand}" />

            <Button Content="Validate"
                    MinWidth="70"
                    Margin="0,0,8,0"
                    Command="{Binding ValidateCommand}" />

            <Button Content="Save"
                    MinWidth="70"
                    Margin="0,0,8,0"
                    Command="{Binding SaveCommand}" />

            <Button Content="Save As..."
                    MinWidth="90"
                    Margin="0,0,8,0"
                    Command="{Binding SaveAsCommand}" />

            <Button Content="Clear"
                    MinWidth="70"
                    Margin="0,0,16,0"
                    Command="{Binding ClearCommand}" />

            <TextBlock Text="View:"
                       VerticalAlignment="Center"
                       Margin="0,0,6,0" />

            <RadioButton Content="Folders"
                         VerticalAlignment="Center"
                         Margin="0,0,8,0"
                         IsChecked="{Binding IsFoldersMode}" />

            <RadioButton Content="Flat"
                         VerticalAlignment="Center"
                         Margin="0,0,16,0"
                         IsChecked="{Binding IsFlatMode}" />

            <CheckBox Content="Include subfolders"
                      VerticalAlignment="Center"
                      Margin="0,0,16,0"
                      IsChecked="{Binding IncludeSubfolders}" />

            <CheckBox Content="Friendly view"
                      VerticalAlignment="Center"
                      Margin="0,0,16,0"
                      IsEnabled="{Binding HasFriendlyView}"
                      IsChecked="{Binding IsFriendlyView}" />

            <CheckBox Content="Dark mode"
                      VerticalAlignment="Center"
                      IsChecked="{Binding IsDarkMode}" />
        </StackPanel>

        <StatusBar DockPanel.Dock="Bottom">
            <TextBlock Text="{Binding Status}" />
        </StatusBar>

        <Grid Margin="8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280" />
                <ColumnDefinition Width="6" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0"
                    BorderThickness="1"
                    BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
                    Padding="6">
                <Grid>
                    <TreeView ItemsSource="{Binding XmlTree}"
                              SelectedItemChanged="TreeView_SelectedItemChanged"
                              Visibility="{Binding IsFoldersMode, Converter={StaticResource BoolToVis}}" />

                    <ListBox ItemsSource="{Binding XmlFiles}"
                             SelectedItem="{Binding SelectedXmlFile}"
                             DisplayMemberPath="DisplayPath"
                             Visibility="{Binding IsFlatMode, Converter={StaticResource BoolToVis}}" />
                </Grid>
            </Border>

            <GridSplitter Grid.Column="1"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          ResizeBehavior="PreviousAndNext"
                          ResizeDirection="Columns" />

            <Grid Grid.Column="2">
                <Grid Visibility="{Binding IsFriendlyView, Converter={StaticResource BoolToVis}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="280" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <DockPanel Grid.Column="0" Margin="0,0,8,0">
                        <ComboBox DockPanel.Dock="Top"
                                  ItemsSource="{Binding FriendlyCollections}"
                                  SelectedItem="{Binding SelectedFriendlyCollection}"
                                  DisplayMemberPath="Title"
                                  Margin="0,0,0,8" />

                        <ListBox ItemsSource="{Binding SelectedFriendlyCollection.Entries}"
                                 SelectedItem="{Binding SelectedFriendlyEntry}"
                                 DisplayMemberPath="Display" />
                    </DockPanel>

                    <DataGrid Grid.Column="1"
                              ItemsSource="{Binding FriendlyFields}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              HeadersVisibility="Column">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Field" Binding="{Binding Name}" IsReadOnly="True" Width="220" />
                            <DataGridTextColumn Header="Value" Binding="{Binding Value, UpdateSourceTrigger=PropertyChanged}" Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>

                <avalonedit:TextEditor x:Name="XmlEditor"
                                       Visibility="{Binding IsFriendlyView, Converter={StaticResource InverseBoolToVis}}"
                                       ShowLineNumbers="True"
                                       FontFamily="Consolas"
                                       FontSize="13"
                                       HorizontalScrollBarVisibility="Auto"
                                       VerticalScrollBarVisibility="Auto"
                                       Background="{Binding EditorBackground}"
                                       Foreground="{Binding EditorForeground}"
                                       infra:AvalonEditTextBinding.Text="{Binding XmlText, Mode=TwoWay}" />
            </Grid>
        </Grid>
    </DockPanel>
</Window>
