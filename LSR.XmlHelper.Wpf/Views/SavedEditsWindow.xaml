<Window
    x:Class="LSR.XmlHelper.Wpf.Views.SavedEditsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Saved Edits"
    Width="1100"
    Height="700"
    Background="{Binding Appearance.SavedEditsWindowBackgroundBrush}"
    FontFamily="{Binding Appearance.UiFontFamily}"
    FontSize="{Binding Appearance.UiFontSize}"
    Foreground="{Binding Appearance.SavedEditsWindowTextBrush}"
    WindowStartupLocation="CenterOwner">
    <Window.Resources>
        <Style TargetType="{x:Type TextBox}">
            <Setter Property="Background" Value="{Binding DataContext.Appearance.SavedEditsWindowControlBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="Foreground" Value="{Binding DataContext.Appearance.SavedEditsWindowTextBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="BorderBrush" Value="{Binding DataContext.Appearance.SavedEditsWindowControlBorderBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="BorderThickness" Value="1" />
        </Style>

        <Style TargetType="{x:Type ComboBox}">
            <Setter Property="Background" Value="{Binding DataContext.Appearance.SavedEditsWindowControlBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="Foreground" Value="{Binding DataContext.Appearance.SavedEditsWindowTextBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="BorderBrush" Value="{Binding DataContext.Appearance.SavedEditsWindowControlBorderBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="BorderThickness" Value="1" />
        </Style>

        <Style TargetType="{x:Type DatePicker}">
            <Setter Property="Foreground" Value="{Binding DataContext.Appearance.SavedEditsWindowTextBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
        </Style>

        <Style TargetType="{x:Type Button}">
            <Setter Property="Foreground" Value="{Binding DataContext.Appearance.SavedEditsWindowTextBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="Background" Value="{Binding DataContext.Appearance.SavedEditsWindowButtonBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="BorderBrush" Value="{Binding DataContext.Appearance.SavedEditsWindowControlBorderBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="10,6" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border
                            x:Name="Root"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            SnapsToDevicePixels="True">
                            <ContentPresenter
                                Margin="{TemplateBinding Padding}"
                                HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                RecognizesAccessKey="True" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="{Binding DataContext.Appearance.SavedEditsWindowButtonHoverBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.6" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="{x:Type TabItem}">
            <Setter Property="Foreground" Value="{Binding DataContext.Appearance.SavedEditsWindowTextBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="Background" Value="{Binding DataContext.Appearance.SavedEditsWindowTabBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="BorderBrush" Value="{Binding DataContext.Appearance.SavedEditsWindowControlBorderBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="10,6" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TabItem}">
                        <Border
                            x:Name="Root"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            SnapsToDevicePixels="True">
                            <ContentPresenter
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                ContentSource="Header"
                                RecognizesAccessKey="True" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="{Binding DataContext.Appearance.SavedEditsWindowTabHoverBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="{Binding DataContext.Appearance.SavedEditsWindowTabSelectedBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.6" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="{x:Type TabControl}">
            <Setter Property="Background" Value="{Binding Appearance.SavedEditsWindowControlBackgroundBrush}" />
            <Setter Property="BorderBrush" Value="{Binding Appearance.SavedEditsWindowControlBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
        </Style>

        <Style TargetType="{x:Type DataGrid}">
            <Setter Property="Background" Value="{Binding DataContext.Appearance.SavedEditsWindowGridBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="Foreground" Value="{Binding DataContext.Appearance.SavedEditsWindowGridTextBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="BorderBrush" Value="{Binding DataContext.Appearance.SavedEditsWindowGridBorderBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="GridLinesVisibility" Value="All" />
            <Setter Property="HorizontalGridLinesBrush" Value="{Binding DataContext.Appearance.SavedEditsWindowGridLinesBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="VerticalGridLinesBrush" Value="{Binding DataContext.Appearance.SavedEditsWindowGridLinesBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
        </Style>

        <Style TargetType="{x:Type DataGridColumnHeader}">
            <Setter Property="Background" Value="{Binding DataContext.Appearance.SavedEditsWindowGridHeaderBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="Foreground" Value="{Binding DataContext.Appearance.SavedEditsWindowGridHeaderTextBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="Padding" Value="8,4" />
        </Style>

        <Style TargetType="{x:Type DataGridRow}">
            <Setter Property="Background" Value="Transparent" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{Binding DataContext.Appearance.SavedEditsWindowGridRowHoverBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{Binding DataContext.Appearance.SavedEditsWindowGridRowSelectedBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="{x:Type DataGridCell}">
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{Binding DataContext.Appearance.SavedEditsWindowGridCellSelectedBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
                    <Setter Property="Foreground" Value="{Binding DataContext.Appearance.SavedEditsWindowGridCellSelectedTextBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="{x:Type CheckBox}">
            <Setter Property="Foreground" Value="{Binding DataContext.Appearance.SavedEditsWindowTextBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type CheckBox}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <Border
                                x:Name="Box"
                                Width="16"
                                Height="16"
                                VerticalAlignment="Center"
                                Background="{Binding DataContext.Appearance.SavedEditsWindowCheckBoxBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}"
                                BorderBrush="{Binding DataContext.Appearance.SavedEditsWindowControlBorderBrush, RelativeSource={RelativeSource AncestorType=Window}}"
                                BorderThickness="1" />

                            <Path
                                x:Name="CheckMark"
                                Grid.Column="0"
                                Width="12"
                                Height="10"
                                Margin="2,0,0,0"
                                VerticalAlignment="Center"
                                Data="M 1 5 L 4 8 L 11 1"
                                Stroke="{Binding DataContext.Appearance.SavedEditsWindowCheckBoxTickBrush, RelativeSource={RelativeSource AncestorType=Window}}"
                                StrokeThickness="2"
                                Visibility="Collapsed" />

                            <ContentPresenter
                                Grid.Column="1"
                                Margin="8,0,0,0"
                                VerticalAlignment="Center"
                                RecognizesAccessKey="True"
                                TextElement.Foreground="{TemplateBinding Foreground}" />
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="CheckMark" Property="Visibility" Value="Visible" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.6" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>
    <DockPanel Margin="10">
        <StackPanel Margin="0,0,0,10" DockPanel.Dock="Top">
            <StackPanel Margin="0,0,0,8" Orientation="Horizontal">
                <TextBlock
                    Margin="0,0,8,0"
                    VerticalAlignment="Center"
                    FontWeight="Bold"
                    Text="File:" />
                <ComboBox
                    Width="980"
                    IsEditable="False"
                    ItemsSource="{Binding FilePaths}"
                    SelectedItem="{Binding SelectedFilePath}" />
            </StackPanel>

            <StackPanel Orientation="Horizontal">
                <TextBlock
                    Margin="0,0,8,0"
                    VerticalAlignment="Center"
                    FontWeight="Bold"
                    Text="Filter:" />
                <TextBox Width="520" Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}" />

                <TextBlock
                    Margin="14,0,8,0"
                    VerticalAlignment="Center"
                    FontWeight="Bold"
                    Text="From:" />
                <DatePicker Width="140" SelectedDate="{Binding DateFrom}" />

                <TextBlock
                    Margin="14,0,8,0"
                    VerticalAlignment="Center"
                    FontWeight="Bold"
                    Text="To:" />
                <DatePicker Width="140" SelectedDate="{Binding DateTo}" />
                <Button
                    Width="170"
                    Margin="14,0,0,0"
                    Command="{Binding ExportEditSummaryCommand}"
                    Content="Export Edit Summary..."
                    ToolTip="Export a readable summary of saved edits to a .txt file." />
            </StackPanel>
        </StackPanel>

        <TabControl>
            <TabItem Header="Pending">
                <DockPanel>
                    <StackPanel
                        Margin="0,0,0,10"
                        DockPanel.Dock="Top"
                        Orientation="Horizontal">
                        <Button
                            Width="140"
                            Command="{Binding ApplySelectedPendingCommand}"
                            Content="Apply Selected"
                            ToolTip="Apply only the checked pending edits to the currently open XML (the selected file must be open in the main window)." />
                        <Button
                            Width="140"
                            Margin="10,0,0,0"
                            Command="{Binding ApplyAllPendingCommand}"
                            Content="Apply All"
                            ToolTip="Apply all visible (filtered) pending edits to the currently open XML (the selected file must be open in the main window)." />

                        <Button
                            Width="140"
                            Margin="30,0,0,0"
                            Command="{Binding DeleteSelectedPendingCommand}"
                            Content="Delete Selected"
                            ToolTip="Delete the checked pending edits from history. This does not change any XML file." />
                        <Button
                            Width="140"
                            Margin="10,0,0,0"
                            Command="{Binding DeleteAllPendingCommand}"
                            Content="Delete All"
                            ToolTip="Delete all visible (filtered) pending edits from history. This does not change any XML file." />
                    </StackPanel>

                    <DataGrid
                        AutoGenerateColumns="False"
                        CanUserAddRows="False"
                        IsReadOnly="False"
                        ItemsSource="{Binding PendingRowsView}"
                        SelectionMode="Extended">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Width="40" Header="">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <CheckBox
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            IsChecked="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTextColumn
                                Width="160"
                                Binding="{Binding Item.TimestampUtc}"
                                Header="When (UTC)"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                Width="140"
                                Binding="{Binding Item.CollectionTitle}"
                                Header="Collection"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                Width="160"
                                Binding="{Binding Item.EntryKey}"
                                Header="Entry"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                Width="180"
                                Binding="{Binding Item.FieldPath}"
                                Header="Field"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                Width="120"
                                Binding="{Binding Item.OldValue}"
                                Header="Old"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                Width="120"
                                Binding="{Binding Item.NewValue}"
                                Header="New"
                                IsReadOnly="True" />
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>

            <TabItem Header="Committed">
                <DockPanel>
                    <StackPanel Margin="0,0,0,10" DockPanel.Dock="Top">
                        <StackPanel Margin="0,0,0,8" Orientation="Horizontal">
                            <Button
                                Width="140"
                                Command="{Binding ApplySelectedCommittedCommand}"
                                Content="Apply Selected"
                                ToolTip="Apply only the checked committed edits to the currently open XML (the selected file must be open in the main window)." />
                            <Button
                                Width="140"
                                Margin="10,0,0,0"
                                Command="{Binding ApplyAllCommittedCommand}"
                                Content="Apply All"
                                ToolTip="Apply all visible (filtered) committed edits to the currently open XML (the selected file must be open in the main window)." />

                            <Button
                                Width="140"
                                Margin="30,0,0,0"
                                Command="{Binding DeleteSelectedCommittedCommand}"
                                Content="Delete Selected"
                                ToolTip="Delete the checked committed edits from history. You will be prompted to create a backup first." />
                            <Button
                                Width="140"
                                Margin="10,0,0,0"
                                Command="{Binding DeleteAllCommittedCommand}"
                                Content="Delete All"
                                ToolTip="Delete all visible (filtered) committed edits from history. You will be prompted to create a backup first." />
                        </StackPanel>

                        <StackPanel Orientation="Horizontal">
                            <TextBlock
                                Margin="0,0,10,0"
                                VerticalAlignment="Center"
                                FontWeight="Bold"
                                Text="Show:" />
                            <CheckBox
                                Margin="0,0,14,0"
                                Content="Active"
                                IsChecked="{Binding ShowActive}"
                                ToolTip="Show committed edits where the current XML value matches the edit's New value." />
                            <CheckBox
                                Margin="0,0,14,0"
                                Content="Outdated"
                                IsChecked="{Binding ShowOutdated}"
                                ToolTip="Show committed edits where the current XML value no longer matches the edit's New value." />
                            <CheckBox
                                Content="Missing"
                                IsChecked="{Binding ShowMissing}"
                                ToolTip="Show committed edits where the entry/field (or file) could not be found/loaded." />
                        </StackPanel>
                    </StackPanel>

                    <DataGrid
                        AutoGenerateColumns="False"
                        CanUserAddRows="False"
                        IsReadOnly="False"
                        ItemsSource="{Binding CommittedRowsView}"
                        SelectionMode="Extended">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn Width="40" Header="">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <CheckBox
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            IsChecked="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <DataGridTextColumn
                                Width="90"
                                Binding="{Binding Status}"
                                Header="State"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                Width="130"
                                Binding="{Binding CurrentValue}"
                                Header="Current"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                Width="160"
                                Binding="{Binding Item.TimestampUtc}"
                                Header="When (UTC)"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                Width="140"
                                Binding="{Binding Item.CollectionTitle}"
                                Header="Collection"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                Width="160"
                                Binding="{Binding Item.EntryKey}"
                                Header="Entry"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                Width="180"
                                Binding="{Binding Item.FieldPath}"
                                Header="Field"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                Width="120"
                                Binding="{Binding Item.OldValue}"
                                Header="Old"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                Width="120"
                                Binding="{Binding Item.NewValue}"
                                Header="New"
                                IsReadOnly="True" />
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>
        </TabControl>
    </DockPanel>
</Window>
