<Window x:Class="LSR.XmlHelper.Wpf.Views.BackupBrowserWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Backup Browser"
        Width="980"
        Height="560"
        WindowStartupLocation="CenterOwner"
        Background="{Binding Appearance.BackgroundBrush}"
        Foreground="{Binding Appearance.TextBrush}"
        FontFamily="{Binding Appearance.UiFontFamily}"
        FontSize="{Binding Appearance.UiFontSize}">

	<Window.Resources>
		<CollectionViewSource x:Key="BackupsView" Source="{Binding Backups}">
			<CollectionViewSource.GroupDescriptions>
				<PropertyGroupDescription PropertyName="SourceXmlDisplay" />
			</CollectionViewSource.GroupDescriptions>
		</CollectionViewSource>
	</Window.Resources>

	<Grid Margin="12">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="8" />
			<RowDefinition Height="*" />
			<RowDefinition Height="8" />
			<RowDefinition Height="Auto" />
			<RowDefinition Height="10" />
			<RowDefinition Height="Auto" />
		</Grid.RowDefinitions>

		<StackPanel Grid.Row="0" Orientation="Vertical">
			<TextBlock Text="Backups folder:" FontSize="16" FontWeight="Bold" Foreground="{Binding Appearance.HeaderTextBrush}" />
			<TextBlock Text="{Binding BackupFolder}" Opacity="0.85" TextWrapping="Wrap" />
			<TextBlock Text="Drag and drop a backup .xml file into this window to add it." Opacity="0.65" Margin="0,6,0,0" TextWrapping="Wrap" />
		</StackPanel>

		<Grid Grid.Row="2">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="230" />
				<ColumnDefinition Width="8" />
				<ColumnDefinition Width="*" />
			</Grid.ColumnDefinitions>

			<Border Grid.Column="0"
                    BorderThickness="1"
                    BorderBrush="{Binding Appearance.GridLinesBrush}"
                    Background="{Binding Appearance.ValueColumnBackgroundBrush}">
				<DockPanel LastChildFill="True">
					<TextBlock DockPanel.Dock="Top"
                               Text="XML filter"
                               Padding="8,6"
                               FontWeight="Bold"
                               Background="{Binding Appearance.GridHeaderBackgroundBrush}"
                               Foreground="{Binding Appearance.GridHeaderTextBrush}" />
					<ListBox ItemsSource="{Binding XmlFilters}"
                             SelectedItem="{Binding SelectedXmlFilter}"
                             DisplayMemberPath="DisplayText"
                             Background="{Binding Appearance.ValueColumnBackgroundBrush}"
                             Foreground="{Binding Appearance.ValueColumnTextBrush}"
                             BorderThickness="0">
						<ListBox.Resources>
							<Style TargetType="{x:Type ListBoxItem}">
								<Setter Property="Background" Value="Transparent" />
								<Setter Property="Foreground" Value="{Binding DataContext.Appearance.ValueColumnTextBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
								<Setter Property="Padding" Value="8,6" />
								<Style.Triggers>
									<Trigger Property="IsMouseOver" Value="True">
										<Setter Property="Background" Value="{Binding DataContext.Appearance.GridRowHoverBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
									</Trigger>
									<Trigger Property="IsSelected" Value="True">
										<Setter Property="Background" Value="{Binding DataContext.Appearance.GridRowSelectedBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
									</Trigger>
								</Style.Triggers>
							</Style>
						</ListBox.Resources>
					</ListBox>
				</DockPanel>
			</Border>

			<GridSplitter Grid.Column="1"
                          Width="8"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          Background="{Binding Appearance.BackgroundBrush}" />

			<Border Grid.Column="2"
                    AllowDrop="True"
                    PreviewDragOver="BackupBrowserWindow_OnPreviewDragOver"
                    Drop="BackupBrowserWindow_OnDrop"
                    BorderThickness="1"
                    BorderBrush="{Binding Appearance.GridLinesBrush}"
                    Background="{Binding Appearance.ValueColumnBackgroundBrush}">
				<ListView ItemsSource="{Binding Source={StaticResource BackupsView}}"
                          SelectedItem="{Binding SelectedBackup}"
                          Background="{Binding Appearance.ValueColumnBackgroundBrush}"
                          Foreground="{Binding Appearance.ValueColumnTextBrush}"
                          BorderThickness="0">
					<ListView.Resources>
						<Style TargetType="{x:Type GridViewColumnHeader}">
							<Setter Property="Background" Value="{Binding DataContext.Appearance.GridHeaderBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
							<Setter Property="Foreground" Value="{Binding DataContext.Appearance.GridHeaderTextBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
							<Setter Property="FontWeight" Value="Bold" />
							<Setter Property="Padding" Value="8,4" />
						</Style>

						<Style TargetType="{x:Type ListViewItem}">
							<Setter Property="Background" Value="Transparent" />
							<Setter Property="Foreground" Value="{Binding DataContext.Appearance.ValueColumnTextBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
							<Setter Property="Padding" Value="6,3" />
							<Setter Property="HorizontalContentAlignment" Value="Stretch" />
							<Style.Triggers>
								<Trigger Property="IsMouseOver" Value="True">
									<Setter Property="Background" Value="{Binding DataContext.Appearance.GridRowHoverBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
								</Trigger>
								<Trigger Property="IsSelected" Value="True">
									<Setter Property="Background" Value="{Binding DataContext.Appearance.GridRowSelectedBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}" />
								</Trigger>
							</Style.Triggers>
						</Style>
					</ListView.Resources>

					<ListView.GroupStyle>
						<GroupStyle>
							<GroupStyle.HeaderTemplate>
								<DataTemplate>
									<Border Background="{Binding DataContext.Appearance.GridHeaderBackgroundBrush, RelativeSource={RelativeSource AncestorType=Window}}"
                                            BorderBrush="{Binding DataContext.Appearance.GridLinesBrush, RelativeSource={RelativeSource AncestorType=Window}}"
                                            BorderThickness="0,0,0,1"
                                            Padding="8,6">
										<TextBlock Text="{Binding Name}"
                                                   Foreground="{Binding DataContext.Appearance.GridHeaderTextBrush, RelativeSource={RelativeSource AncestorType=Window}}"
                                                   FontWeight="Bold" />
									</Border>
								</DataTemplate>
							</GroupStyle.HeaderTemplate>
						</GroupStyle>
					</ListView.GroupStyle>

					<ListView.View>
						<GridView>
							<GridViewColumn Header="Date" Width="170" DisplayMemberBinding="{Binding LastWriteText}" />
							<GridViewColumn Header="Backup file" Width="560" DisplayMemberBinding="{Binding FileName}" />
							<GridViewColumn Header="Size" Width="90" DisplayMemberBinding="{Binding SizeText}" />
						</GridView>
					</ListView.View>
				</ListView>
			</Border>
		</Grid>

		<TextBlock Grid.Row="4"
                   Text="{Binding Status}"
                   Foreground="{Binding Appearance.HeaderTextBrush}" />

		<StackPanel Grid.Row="6" Orientation="Horizontal" HorizontalAlignment="Right">
			<StackPanel.Resources>
				<Style TargetType="{x:Type Button}">
					<Setter Property="Foreground" Value="{Binding Appearance.TopButtonTextBrush}" />
					<Setter Property="Background" Value="{Binding Appearance.TopButtonBackgroundBrush}" />
					<Setter Property="Padding" Value="10,6" />
					<Setter Property="MinWidth" Value="120" />
					<Setter Property="Margin" Value="0,0,8,0" />
				</Style>
			</StackPanel.Resources>

			<Button Content="Refresh" Command="{Binding RefreshCommand}" MinWidth="90" />
			<Button Content="Open Folder" Command="{Binding OpenBackupFolderCommand}" MinWidth="110" />
			<Button Content="Restore Selected" Command="{Binding RestoreCommand}" />
			<Button Content="Cancel" Command="{Binding CancelCommand}" Margin="0,0,0,0" />
		</StackPanel>
	</Grid>
</Window>
